
<metal:main use-macro="load: ../master.pt">
   <!-- Insere JavaScript -->
   <div metal:fill-slot="conteudo" id="widgets">
      <header>
         <!--basic styles-->
         <!--<link href="static/ace-final/assets/css/bootstrap.min.css" rel="stylesheet" />
            <link href="static/ace-final/assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
            <link rel="stylesheet" href="static/ace-final/assets/css/font-awesome.min.css" />-->
         <!--[if IE 7]>
         <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
         <![endif]-->
         <!--page specific plugin styles-->
         <!--fonts-->
         <!--<link rel="stylesheet" href="static/ace-final/assets/css/ace-fonts.css" />-->
         <!--ace styles-->
         <!--<link rel="stylesheet" href="static/ace-final/assets/css/ace.min.css" />
            <link rel="stylesheet" href="static/ace-final/assets/css/ace-responsive.min.css" />
            <link rel="stylesheet" href="static/ace-final/assets/css/ace-skins.min.css" />-->
         <!--[if lte IE 8]>
         <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
         <![endif]-->
         <!--inline styles related to this page-->
         <!--basic scripts-->
         <!--[if !IE]>-->
         <!--<script type="text/javascript">
            window.jQuery || document.write("<script src='static/ace-final/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
            </script>-->
         <!--<![endif]-->
         <!--[if IE]>
         <script type="text/javascript">
            window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
         </script>
         <![endif]-->
         <!--<script type="text/javascript">
            if("ontouchend" in document) document.write("<script src='static/ace-final/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
            </script>
            <script src="static/ace-final/assets/js/bootstrap.min.js"></script>-->
         <!--page specific plugin scripts-->
         <!--ace scripts-->
         <!--<script src="static/ace-final/assets/js/ace-elements.min.js"></script>
            <script src="static/ace-final/assets/js/ace.min.js"></script>-->
         <!--inline scripts related to this page-->
      </header>
      <div id="controller-data" style="display:none">
        ${base_json}
      </div>
      <div class="page-content">
         <div class="row-fluid">
            <div class="span12">
               <!--PAGE CONTENT BEGINS-->
               <div class="row-fluid" id="all-form">
                  <div class="span12">
                     <div class="widget-box">
                        <div class="widget-header widget-header-blue widget-header-flat">
                           <h4 class="lighter">Editar Base</h4>
                        </div>
                        <div class="widget-body">
                           <div class="widget-main">
                              <div class="row-fluid">
                                 <div id="fuelux-wizard" class="row-fluid hide" data-target="#step-container">
                                    <ul class="wizard-steps">
                                       <li data-target="#step1" class="active">
                                          <span id="step1-button" class="step">1</span>
                                          <span class="title">Metadados</span>
                                       </li>
                                       <li data-target="#step2">
                                          <span id="step2-button" class="step">2</span>
                                          <span class="title">Estrutura</span>
                                       </li>
                                       <li data-target="#step3">
                                          <span id="step3-button" class="step">3</span>
                                          <span class="title">Salvar Base</span>
                                       </li>
                                    </ul>
                                 </div>
                                 <div class="step-content row-fluid position-relative" id="step-container">
                                    <div class="step-pane active" id="step1">
                                       <h3 class="lighter block green">Informações da Base</h3>
                                       <form class="form-horizontal" id="validation-form" method="get">
                                          <div class="control-group">
                                             <label class="control-label" for="email">Nome:</label>
                                             <div class="controls">
                                                <div class="span6">
                                                   <input type="text" name="name" id="base-name" class="span6" />
                                                </div>
                                             </div>
                                          </div>
                                          <div class="control-group">
                                             <label class="control-label">Descrição:</label>
                                             <div class="controls">
                                                <div class="span12">
                                                   <input class="span6" type="text" name="description" id="base-description" class="span4" />
                                                </div>
                                             </div>
                                          </div>
                                          <div class="control-group">
                                             <label class="control-label">Senha:</label>
                                             <div class="controls">
                                                <div class="span12">
                                                   <input class="span6" type="password" name="password" id="base-password" class="span4" />
                                                </div>
                                             </div>
                                          </div>
                                          <div class="control-group">
                                             <label class="control-label">Confirmar Senha:</label>
                                             <div class="controls">
                                                <div class="span12">
                                                   <input class="span6" type="password" name="password_again" id="base-password-confirm" class="span4" />
                                                </div>
                                             </div>
                                          </div>

                                            <!-- COLORPICKER -->
                                          <div class="control-group">
                                             <label class="control-label">Cor da base:</label>
                                             <div class="controls">
                                                <div class="span1">
                                                    <select id="base-color" name="color" class="hide">
                                                        <option value="#ac725e">#ac725e</option>
                                                        <option value="#d06b64">#d06b64</option>
                                                        <option value="#f83a22">#f83a22</option>
                                                        <option value="#fa573c">#fa573c</option>
                                                        <option value="#ff7537">#ff7537</option>
                                                        <option value="#ffad46" selected="">#ffad46</option>
                                                        <option value="#42d692">#42d692</option>
                                                        <option value="#16a765">#16a765</option>
                                                        <option value="#7bd148">#7bd148</option>
                                                        <option value="#b3dc6c">#b3dc6c</option>
                                                        <option value="#fbe983">#fbe983</option>
                                                        <option value="#fad165">#fad165</option>
                                                        <option value="#92e1c0">#92e1c0</option>
                                                        <option value="#9fe1e7">#9fe1e7</option>
                                                        <option value="#9fc6e7">#9fc6e7</option>
                                                        <option value="#4986e7">#4986e7</option>
                                                        <option value="#9a9cff">#9a9cff</option>
                                                        <option value="#b99aff">#b99aff</option>
                                                        <option value="#c2c2c2">#c2c2c2</option>
                                                        <option value="#cabdbf">#cabdbf</option>
                                                        <option value="#cca6ac">#cca6ac</option>
                                                        <option value="#f691b2">#f691b2</option>
                                                        <option value="#cd74e6">#cd74e6</option>
                                                        <option value="#a47ae2">#a47ae2</option>
                                                        <option value="#555">#555</option>
                                                    </select>
                                                </div>
                                             </div>
                                          </div>
                                            <!-- COLORPICKER ENDS -->
                                          <div class="control-group" style="display:none;">
                                             <label class="control-label">Exportar Indice:</label>
                                             <div class="controls">
                                                <span class="span12">
                                                <label>
                                                <input name="index_export" id="index_export" class="ace-switch ace-switch-6" type="checkbox" />
                                                <span class="lbl"></span>
                                                </label>
                                                </span>
                                             </div>
                                          </div>
                                          <div id="control-group-URL">
                                             <div class="control-group">
                                                <label id="URL_label" class="control-label" for="URL">URL do indexador:</label>
                                                <div class="controls">
                                                   <span class="span12">
                                                   <input class="span6" type="text" id="URL_input" name="index_url" />
                                                   </span>
                                                </div>
                                             </div>
                                             <div class="control-group">
                                                <label class="control-label" for="name">Tempo de espera da indexação:</label>
                                                <div class="controls">
                                                   <span class="span12">
                                                      <input name="index_time" type="text" class="input-mini" id="spinner1" />
                                                      <div class="space-6"></div>
                                                   </span>
                                                </div>
                                             </div>
                                          </div>
                                          <div class="control-group" style="display:none;">
                                             <label class="control-label">Extrair texto do documento:</label>
                                             <div class="controls">
                                                <span class="span12">
                                                <label>
                                                <input name="doc_extract" id="doc_extract" class="ace-switch ace-switch-6" type="checkbox" />
                                                <span class="lbl"></span>
                                                </label>
                                                </span>
                                             </div>
                                          </div>
                                          <div id="control-group-DOC">
                                             <div class="control-group">
                                                <label class="control-label" for="name">Tempo de espera da extração:</label>
                                                <div class="controls">
                                                   <span class="span12">
                                                      <input name="extract_time" type="text" class="input-mini" id="spinner2" />
                                                      <div class="space-6"></div>
                                                   </span>
                                                </div>
                                             </div>
                                          </div>
                                       </form>
                                    </div>
                                    <div class="step-pane" id="step2">
                                       <div class="row-fluid">
                                          <!-- BASE STRUCTURE AND CONTEXT -->
                                          <div id="base-widget">
                                             <header>
                                                <link rel="stylesheet" type="text/css" href="/static/nestable-theme/jquery.nestable.css">
                                                <style>
                                                   .error{
                                                   color:#db8978;
                                                   }
                                                </style>
                                             </header>
                                             <div id="nestable-to-validate" class="row-fluid">
                                                <div class="span7">
                                                   <div class="widget-box">
                                                      <div class="widget-header">
                                                         <h4>Estrutura da Base</h4>
                                                         <span class="widget-toolbar">
                                                         </span>
                                                      </div>
                                                      <div class="widget-body">
                                                         <div class="widget-toolbox">
                                                            <div class="btn-toolbar">
                                                               <div class="btn-group">
                                                                  <button class="btn btn-small btn-info" data-action="create-field">
                                                                  <i class="icon-plus"></i>
                                                                  Campo
                                                                  </button>
                                                                  <button class="btn btn-small btn-info" data-action="create-group">
                                                                  <i class="icon-plus bigger-110"></i>
                                                                  Grupo
                                                                  </button>
                                                               </div>
                                                               <div class="btn-group">
                                                                  <button class="btn btn-small" data-action="collapse-all">
                                                                  <i class="icon-collapse-top"></i>
                                                                  Colapsar
                                                                  </button>
                                                                  <button class="btn btn-small" data-action="expand-all">
                                                                  <i class="icon-collapse"></i>
                                                                  Expandir
                                                                  </button>
                                                               </div>
                                                               <div class="btn-group">
                                                                  <button class="btn btn-small btn-danger" data-action="remove-element">
                                                                  <i class="icon-remove"></i>
                                                                  Deletar
                                                                  </button>
                                                               </div>
                                                               <div class="btn-group open">
                                                                  <button data-toggle="dropdown" class="btn btn-small btn-grey dropdown-toggle">
                                                                  <i class="icon-caret-down icon-only bigger-110"></i>
                                                                  </button>
                                                                  <ul class="dropdown-menu pull-right dropdown-caret dropdown-close">
                                                                     <li>
                                                                        <a href='javascript:void(0);' data-action="auto-append">
                                                                        <i class="icon-indent-right"></i>
                                                                        Auto indentação
                                                                        </a>
                                                                     </li>
                                                                  </ul>
                                                               </div>
                                                            </div>
                                                         </div>
                                                         <div id="div-to-scroll" class="widget-main" style="height:425px; overflow:auto;">
                                                            <!-- nestable list -->
                                                            <div class="dd" id="nestable">
                                                               <ol id="base-structure" class="dd-list"></ol>
                                                            </div>
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                                <div class="span5">
                                                   <div class="widget-box">
                                                      <div class="widget-header">
                                                         <h4>Propriedades</h4>
                                                         <span class="widget-toolbar">
                                                         </span>
                                                      </div>
                                                      <div class="widget-body">
                                                         <div id="base-context" class="widget-main" style="overflow:auto;">
                                                         </div>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                          <!-- BASE STRUCTURE AND CONTEXT ENDS-->
                                       </div>
                                    </div>
                                    <div class="step-pane" id="step3">
                                       <div class="center">
                                          <h3 class="blue lighter">Você esta prestes a salvar uma base!</h3>
                                          <div class="row-fluid center">
                                             <div class="span12">
                                                <textarea id="nestable-output" class="m-wrap span12"></textarea>
                                             </div>
                                             <div id="auto-append-info" class="control-group info" hidden>
                                                <div class="controls">
                                                   <span class="span6 input-icon input-icon-right">
                                                   <input class="span12" type="text" value="Auto indentação ativada">
                                                   <i class="icon-info-sign"></i>
                                                   </span>
                                                </div>
                                             </div>
                                          </div>
                                          <p>
                                             <button id="save-data" type="submit" class="btn btn-purple" style="width: 37%;">Salvar Base</button>
                                          </p>
                                       </div>
                                    </div>
                                    <div class="step-pane" id="step4">
                                    </div>
                                 </div>
                                 <div id="submit-buttons" class="row-fluid wizard-actions">
                                    <button id="button-prev" class="btn btn-prev">
                                    <i class="icon-arrow-left"></i>
                                    Anterior
                                    </button>
                                    <button id="button-submit" class="btn btn-success" data-last="Finish ">
                                    Próximo
                                    <i class="icon-arrow-right icon-on-right"></i>
                                    </button>
                                 </div>
                              </div>
                           </div>
                           <!--/widget-main-->
                        </div>
                        <!--/widget-body-->
                     </div>
                  </div>
               </div>
               <div id="modal-wizard" class="modal hide">
                  <div class="modal-footer wizard-actions">
                     <button class="btn btn-small btn-prev">
                     <i class="icon-arrow-left"></i>
                     Prev
                     </button>
                     <button class="btn btn-success btn-small" data-last="Finish ">
                     Next
                     <i class="icon-arrow-right icon-on-right"></i>
                     </button>
                     <button class="btn btn-danger btn-small pull-left" data-dismiss="modal">
                     <i class="icon-remove"></i>
                     Cancel
                     </button>
                  </div>
               </div>
               <!--PAGE CONTENT ENDS-->
            </div>
            <!--/.span-->
         </div>
         <!--/.row-fluid-->
      </div>
      <!--/.page-content-->
   </div>
</metal:main>
<script src="/static/js/ace/fuelux.wizard.min.js"></script>
<script src="/static/js/ace/jquery.validate.min.js"></script>
<script src="/static/js/lightbase/base_form.js"></script>
<script src="/static/js/lightbase/jquery.nestable.js"></script>
<script src="/static/js/ace/additional-methods.min.js"></script>
<script src="/static/js/ace/bootbox.min.js"></script>
<script src="/static/js/lightbase/requisicaoajax.js"></script>
<!-- colorpicker -->
<script src="/static/ace-final/assets/js/bootstrap-colorpicker.min.js"></script>

<!-- countings-->
<script src="/static/js/ace/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/static/js/ace/chosen.jquery.min.js"></script>
<script src="/static/js/ace/fuelux.spinner.min.js"></script>
<script src="/static/js/ace/jquery.autosize-min.js"></script>
<script src="/static/js/ace/jquery.maskedinput.min.js"></script>
<script type="text/javascript">
   $(function() {
   
   
                $.validator.addMethod('alphanumeric', function (value, element) {
                    /*http://stackoverflow.com/questions/4977898/check-for-valid-sql-column-name*/
                    return /^[a-zA-Z_][a-zA-Z0-9_]*$/.test(value);
                }, "Preencha com caracteres válidos");
              basedata = new Object();
              var x = {   
        errorElement: 'span',
        errorClass: 'help-inline',
        focusInvalid: false,
        rules: {
            name: {
                required: true,
                            alphanumeric: "required",
                            maxlength: 23
            },
            description: {
                required: true,
                            maxlength: 256
            },
            password: {
                required: true,
            },
            password_again: {
                required: true,
                equalTo: '#base-password'
            },
            index_export: {
                            required: false
            },
            index_url: {
                            url: true,
                required: {
                                     depends: function(element){
                                                  var checked = false;
                                                  if ($("#index_export:checked").val() !== undefined){
                                                     checked = true
                                                  }
                                                  return checked
                                              }                                        
                            }
            },
            index_time: {
                            required: false
            },
            document_extract: {
                required: false
                
            },
            extraction_time: {
                required: false
            },
            state: {
                required: false
            },
            platform: {
                required: false
            },
            subscription: {
                required: false
            },
            gender: 'required',
            agree: 'required'
        },
   
        messages: {
            name: {
                required: "É necessario preencher o campo"
            },
            description: {
                required: "É necessario preencher o campo"
            },
                        index_url: {
                            required: "É necessario preencher o campo"
                        }
        },
   
        invalidHandler: function (event, validator) { //display error alert on form submit   
            $('.alert-error', $('.login-form')).show();
        },
   
        highlight: function (e) {
            $(e).closest('.control-group').removeClass('info').addClass('error');
        },
   
        success: function (e) {
            $(e).closest('.control-group').removeClass('error').addClass('info');
            $(e).remove();
        },
   
        errorPlacement: function (error, element) {
            if(element.is(':checkbox') || element.is(':radio')) {
                var controls = element.closest('.controls');
                if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
                else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
            }
            else if(element.is('.chzn-select')) {
                error.insertAfter(element.siblings('[class*="chzn-container"]:eq(0)'));
            }
            else error.insertAfter(element);
        },
   
        submitHandler: function (form) {
        },
        invalidHandler: function (form) {
        }
                };
   
    $('[data-rel=tooltip]').tooltip();
   
   
    var $validation = true;
    $('#fuelux-wizard').ace_wizard().on('change' , function(e, info){
        if(info.step == 1 && $validation) {
            if(!$('#validation-form').valid()) return false;
        }
    }).on('stepclick', function(e){
        //return false;//prevent clicking on steps
    });
   
   
    $('#sample-form').hide();
       $('#validation-form').show();
   
    $('#modal-wizard .modal-header').ace_wizard();
    $('#modal-wizard .wizard-actions .btn[data-dismiss=modal]').removeAttr('disabled');
                
                $('#validation-form').submit(function() {
                    var formdata = $("#validation-form").serializeArray();
                    var returnArray = new Object();
                    $.each(formdata, function(i, v){
                        if (v.name == "doc_extract"){
                            v.value = true
                        }
                        if (v.name == "index_export"){
                            v.value = true
                        }
                        returnArray[v.name] = v.value;
                    });
                        if (!("doc_extract" in returnArray)){
                            returnArray["doc_extract"] = false;
                        }
                        if (!("index_export" in returnArray)){
                            returnArray["index_export"] = false;
                        }
                        return returnArray;
                });
                $("#control-group-URL").hide();
                $("#index_export").click(function(){
                    if ($("#index_export:checked").val() == undefined){
                        $("#control-group-URL").hide();
                    }else{
                        $("#control-group-URL").show();
                    }
                });
   
                $("#control-group-DOC").hide();
                $("#doc_extract").click(function(){
                    if ($("#doc_extract:checked").val() == undefined){
                        $("#control-group-DOC").hide();
                    }else{
                        $("#control-group-DOC").show();
                    }
                });
   
                var button = document.getElementById("button-submit");
                $("#button-submit").click(function(){
                    if ($("#fuelux-wizard").wizard("selectedItem").step == 1){
                        $('#validation-form').validate(x);
                        $("#fuelux-wizard").wizard("next");
                        var formdata = $("#validation-form").serializeArray();
                        var returnArray = new Object();
                        $.each(formdata, function(i, v){
                            if (v.name == "doc_extract"){
                                v.value = true
                            }
                            if (v.name == "index_export"){
                                v.value = true
                            }
                            returnArray[v.name] = v.value;
                        });
                        if (!("doc_extract" in returnArray)){
                            returnArray["doc_extract"] = false;
                        }
                        if (!("index_export" in returnArray)){
                            returnArray["index_export"] = false;
                        }
                        basedata["metadata"] = returnArray;
                        basedata["structure"] = base.structure; 
                        basedata["context"] = base.context.context;
                        base.metadata = returnArray;
                        delete returnArray["password_again"];
                        return false;
                    }
                    if ($("#fuelux-wizard").wizard("selectedItem").step == 2 && base.context.validate() == true){
                        $("#fuelux-wizard").wizard("next");
                    }
                    if ($('#fuelux-wizard').wizard("selectedItem").step == 3){
                        var textarea = document.getElementById("nestable-output");
                        textarea.value = base.json;
                        textarea.setAttribute('style','height: 100px;');
                        button.setAttribute('style','display:none;');
                        textarea.disabled = true;
                    }
                });
   
                $("#step1-button").click(function(){
                        button.setAttribute('style','display:inline;');
                });
                $("#step2-button").click(function(){
                        button.setAttribute('style','display:inline;');
                });
   
                $("#button-prev").click(function(){
                    if ($('#fuelux-wizard').wizard("selectedItem").step == 2){
                        button.setAttribute('style','display:inline;');
                    }
                });
   
                $("#save-data").click( function(){
                    $("#button-submit").click();
                    $.ajax({
                        type: 'post',
                        url: window.location,
                        data: {
                            json_base: base.json,
                        },
                        success: function(data, textStatus, jqXHR ){
                            bootbox.dialog("Obrigado! Sua base foi salva com sucesso!", [{
                                "label" : "OK",
                                "class" : "btn-small btn-primary",
                                "href": '/base/list',
                                }]
                            );
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            window.location.href = '/error-500';
                        }
                    });
                });
   
   
                }); 
</script>
<script type="text/javascript">
   $(document).ready(function()
   {
        $('#spinner1').ace_spinner({value:0,min:0,max:200,step:10, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
   
        $('#spinner2').ace_spinner({value:0,min:0,max:200,step:10, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
       $('button[data-action="create-field"]').click(function(){
           base.create_field(remand=false, check_valid=true);
       });
       $('button[data-action="create-group"]').click(function(){
           base.create_group();
       });
       $('button[data-action="expand-all"]').click(function(){
           $('.dd').nestable('expandAll');
       });
       $('button[data-action="collapse-all"]').click(function(){
           $('.dd').nestable('collapseAll');
       });
       $('button[data-action="remove-element"]').click(function(){
           base.remove_element();
       });
       $('a[data-action="auto-append"]').click(function(){
           if (base.auto_append){
               base.auto_append = false;
               $('#auto-append-info').hide();
           }
           else{
               base.auto_append = true;
               $('#auto-append-info').show();
           }
       });
   
          var drop_callback = function(drop_info){
               // Select list-item and focus on form
               base.context.focus_on('base-context-' + drop_info.sourceId + '-form');
               if(base.auto_append){
                   if(base.current_item.is_group){
                       base.auto_append_el = $(base.current_item).children('ol')[0]; 
                   }
                   else{
                       base.auto_append_el = undefined; 
                   }
               }
   
           }
   
       $('#nestable').nestable({
           group: 1,
           maxDepth: 10,
           dropCallback: drop_callback
       })

        var base_json = JSON.parse($('#controller-data').text());
        base.context.edit_mode = true;
        base.build_from_json(base_json);
        base.context.edit_mode = false;
   
   });
   
</script>

		<script type="text/javascript">
			$(function() {
				$('#id-disable-check').on('click', function() {
					var inp = $('#form-input-readonly').get(0);
					if(inp.hasAttribute('disabled')) {
						inp.setAttribute('readonly' , 'true');
						inp.removeAttribute('disabled');
						inp.value="This text field is readonly!";
					}
					else {
						inp.setAttribute('disabled' , 'disabled');
						inp.removeAttribute('readonly');
						inp.value="This text field is disabled!";
					}
				});
			
			
				$(".chzn-select").chosen(); 
				
				$('[data-rel=tooltip]').tooltip({container:'body'});
				$('[data-rel=popover]').popover({container:'body'});
				
				$('textarea[class*=autosize]').autosize({append: "\n"});
				$('textarea[class*=limited]').each(function() {
					var limit = parseInt($(this).attr('data-maxlength')) || 100;
					$(this).inputlimiter({
						"limit": limit,
						remText: '%n character%s remaining...',
						limitText: 'max allowed : %n.'
					});
				});
				
				$.mask.definitions['~']='[+-]';
				$('.input-mask-date').mask('99/99/9999');
				$('.input-mask-phone').mask('(999) 999-9999');
				$('.input-mask-eyescript').mask('~9.99 ~9.99 999');
				$(".input-mask-product").mask("a*-999-a999",{placeholder:" ",completed:function(){alert("You typed the following: "+this.val());}});
				
				
				
				$( "#input-size-slider" ).css('width','200px').slider({
					value:1,
					range: "min",
					min: 1,
					max: 6,
					step: 1,
					slide: function( event, ui ) {
						var sizing = ['', 'input-mini', 'input-small', 'input-medium', 'input-large', 'input-xlarge', 'input-xxlarge'];
						var val = parseInt(ui.value);
						$('#form-field-4').attr('class', sizing[val]).val('.'+sizing[val]);
					}
				});
			
				$( "#input-span-slider" ).slider({
					value:1,
					range: "min",
					min: 1,
					max: 11,
					step: 1,
					slide: function( event, ui ) {
						var val = parseInt(ui.value);
						$('#form-field-5').attr('class', 'span'+val).val('.span'+val).next().attr('class', 'span'+(12-val)).val('.span'+(12-val));
					}
				});
				
				
				$( "#slider-range" ).css('height','200px').slider({
					orientation: "vertical",
					range: true,
					min: 0,
					max: 100,
					values: [ 17, 67 ],
					slide: function( event, ui ) {
						var val = ui.values[$(ui.handle).index()-1]+"";
			
						if(! ui.handle.firstChild ) {
							$(ui.handle).append("<div class='tooltip right in' style='display:none;left:15px;top:-8px;'><div class='tooltip-arrow'></div><div class='tooltip-inner'></div></div>");
						}
						$(ui.handle.firstChild).show().children().eq(1).text(val);
					}
				}).find('a').on('blur', function(){
					$(this.firstChild).hide();
				});
				
				$( "#slider-range-max" ).slider({
					range: "max",
					min: 1,
					max: 10,
					value: 2
				});
				
				$( "#eq > span" ).css({width:'90%', 'float':'left', margin:'15px'}).each(function() {
					// read initial values from markup and remove that
					var value = parseInt( $( this ).text(), 10 );
					$( this ).empty().slider({
						value: value,
						range: "min",
						animate: true
						
					});
				});
			
				
				$('#id-input-file-1 , #id-input-file-2').ace_file_input({
					no_file:'No File ...',
					btn_choose:'Choose',
					btn_change:'Change',
					droppable:false,
					onchange:null,
					thumbnail:false //| true | large
					//whitelist:'gif|png|jpg|jpeg'
					//blacklist:'exe|php'
					//onchange:''
					//
				});
				
				$('#id-input-file-3').ace_file_input({
					style:'well',
					btn_choose:'Drop files here or click to choose',
					btn_change:null,
					no_icon:'icon-cloud-upload',
					droppable:true,
					thumbnail:'small'
					//,icon_remove:null//set null, to hide remove/reset button
					/**,before_change:function(files, dropped) {
						//Check an example below
						//or examples/file-upload.html
						return true;
					}*/
					/**,before_remove : function() {
						return true;
					}*/
					,
					preview_error : function(filename, error_code) {
						//name of the file that failed
						//error_code values
						//1 = 'FILE_LOAD_FAILED',
						//2 = 'IMAGE_LOAD_FAILED',
						//3 = 'THUMBNAIL_FAILED'
						//alert(error_code);
					}
			
				}).on('change', function(){
					//console.log($(this).data('ace_input_files'));
					//console.log($(this).data('ace_input_method'));
				});
				
			
				//dynamically change allowed formats by changing before_change callback function
				$('#id-file-format').removeAttr('checked').on('change', function() {
					var before_change
					var btn_choose
					var no_icon
					if(this.checked) {
						btn_choose = "Drop images here or click to choose";
						no_icon = "icon-picture";
						before_change = function(files, dropped) {
							var allowed_files = [];
							for(var i = 0 ; i < files.length; i++) {
								var file = files[i];
								if(typeof file === "string") {
									//IE8 and browsers that don't support File Object
									if(! (/\.(jpe?g|png|gif|bmp)$/i).test(file) ) return false;
								}
								else {
									var type = $.trim(file.type);
									if( ( type.length > 0 && ! (/^image\/(jpe?g|png|gif|bmp)$/i).test(type) )
											|| ( type.length == 0 && ! (/\.(jpe?g|png|gif|bmp)$/i).test(file.name) )//for android's default browser which gives an empty string for file.type
										) continue;//not an image so don't keep this file
								}
								
								allowed_files.push(file);
							}
							if(allowed_files.length == 0) return false;
			
							return allowed_files;
						}
					}
					else {
						btn_choose = "Drop files here or click to choose";
						no_icon = "icon-cloud-upload";
						before_change = function(files, dropped) {
							return files;
						}
					}
					var file_input = $('#id-input-file-3');
					file_input.ace_file_input('update_settings', {'before_change':before_change, 'btn_choose': btn_choose, 'no_icon':no_icon})
					file_input.ace_file_input('reset_input');
				});
			
			
			
			
				$('#spinner1').ace_spinner({value:0,min:0,max:200,step:10, btn_up_class:'btn-info' , btn_down_class:'btn-info'})
				.on('change', function(){
					//alert(this.value)
				});
				$('#spinner2').ace_spinner({value:0,min:0,max:10000,step:100, icon_up:'icon-caret-up', icon_down:'icon-caret-down'});
				$('#spinner3').ace_spinner({value:0,min:-100,max:100,step:10, icon_up:'icon-plus', icon_down:'icon-minus', btn_up_class:'btn-success' , btn_down_class:'btn-danger'});
			
				$('#colorpicker1').colorpicker();
				$('#base-color').ace_colorpicker();
			
				//we could just set the data-provide="tag" of the element inside HTML, but IE8 fails!
				var tag_input = $('#form-field-tags');
			
			
				/////////
				$('#modal-form input[type=file]').ace_file_input({
					style:'well',
					btn_choose:'Drop files here or click to choose',
					btn_change:null,
					no_icon:'icon-cloud-upload',
					droppable:true,
					thumbnail:'large'
				})
				
				//chosen plugin inside a modal will have a zero width because the select element is originally hidden
				//and its width cannot be determined.
				//so we set the width after modal is show
				$('#modal-form').on('show', function () {
					$(this).find('.chzn-container').each(function(){
						$(this).find('a:first-child').css('width' , '200px');
						$(this).find('.chzn-drop').css('width' , '210px');
						$(this).find('.chzn-search input').css('width' , '200px');
					});
				})
				/**
				//or you can activate the chosen plugin after modal is shown
				//this way select element has a width now and chosen works as expected
				$('#modal-form').on('shown', function () {
					$(this).find('.modal-chosen').chosen();
				})
				*/
			
			});
		</script>
